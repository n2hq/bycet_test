import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as i,e as M,a as Q}from"./components-CqyJs_9b.js";import{A as Y}from"./AccountLayout-QOHrx1by.js";import{C as q}from"./ContentLayout-SpVwgp8S.js";import{Q as K,B as X,u as B,f as C,a9 as Z,ad as ee,ae as se,r as te,af as re}from"./lib-d-OCgvip.js";import{u as oe}from"./AuthContext-BH94oN1s.js";import{u as ie,a as ne}from"./zod-DwrW5z8F.js";import{B as ae}from"./Button-7Woa2p3a.js";import{I as G}from"./Input-D3HOu0t0.js";import{T as le}from"./TextareaWithWordLimit-DQRzKMej.js";import{c as ce}from"./css-CVxtJxAn.js";import{u as ue}from"./OperationContext-BdFCpeXF.js";import{o as de,s as I}from"./types-DBTFAyTi.js";import{P as me}from"./Pagination-DIrFETbL.js";import"./LeftNav-Cj9_gra7.js";import"./HomeNav-C5gVOegL.js";import"./MainNav-oY7cNyR2.js";import"./index-CTCnFI3k.js";import"./BusinessMenu-CYgnqm1J.js";import"./BusinessDrawer-_Mi3vA0Y.js";const L=i.createContext(null),R=()=>{const t=i.useContext(L);return t||null},pe=({children:t})=>{const[d,s]=i.useState(!1),[g,a]=i.useState(""),[E,p]=i.useState(""),[r,n]=i.useState(null),[f,x]=i.useState(null),[T,b]=i.useState(!1);i.useEffect(()=>{r!==null&&V(r),r===null&&(_("service_name",""),_("service_description",""),_("service_url",""))},[r]);const{showOperation:h,showSuccess:j,showError:y,showWarning:D,showInfo:A,completeOperation:c}=ue(),P=async l=>{const S=C.BASE_URL+"/api/listing/services";try{const u=await fetch(S,{method:"POST",headers:B,body:JSON.stringify(l)});if(u.ok)j("Success","Service added successfully."),await new Promise(o=>setTimeout(o,2e3)),h("processing","Reloading..."),await new Promise(o=>setTimeout(o,3e3)),window.location.reload(),await new Promise(o=>setTimeout(o,3e3)),c();else{const o=await u.text(),m=JSON.parse(o);throw new Error(`${m.error}`)}}catch(u){y("error",`${u.message}`),c()}finally{b(!1)}},k=async l=>{const v="/api/listing/services/"+(r==null?void 0:r.service_guid),S=C.BASE_URL+v;try{const u=await fetch(S,{method:"PUT",headers:B,body:JSON.stringify(l)});if(u.ok)j("Success","Service UPDATED successfully."),await new Promise(o=>setTimeout(o,2e3)),h("processing","Reloading..."),await new Promise(o=>setTimeout(o,3e3)),window.location.reload(),await new Promise(o=>setTimeout(o,3e3)),c();else{const o=await u.text(),m=JSON.parse(o);throw new Error(`${m.error}`)}}catch(u){y("error",`${u.message}`),c()}finally{b(!1)}},O=async l=>{b(!0),r===null?h("processing","Adding service..."):h("processing","Updating service..."),await new Promise(v=>setTimeout(v,1e3)),r===null?(l.user_guid=g,l.business_guid=E,JSON.parse(JSON.stringify(l)),P(l)):k(l)},w=l=>{let v=l.target.value,S=l.target.name;x(u=>({...u,[S]:v}))},{register:N,handleSubmit:J,getValues:$,setValue:_,watch:W,reset:V,setError:we,formState:{errors:U,isSubmitting:ve}}=ie({defaultValues:r,resolver:ne(xe)});let F={setDialog:s,setUserGuid:a,setBusinessGuid:p,setServiceProfile:n};const z=async l=>{if(confirm("Do you wish to delete this service. Once deleted, you cannot recover it?")===!0){h("processing","Deleting service..."),await new Promise(o=>setTimeout(o,2e3));const S="/api/listing/services/"+(r==null?void 0:r.service_guid),u=C.BASE_URL+S;try{const o=await fetch(u,{method:"DELETE",headers:B});if(o.ok)j("Success","Service DELETED successfully."),await new Promise(m=>setTimeout(m,2e3)),h("processing","Reloading..."),await new Promise(m=>setTimeout(m,3e3)),window.location.reload(),await new Promise(m=>setTimeout(m,3e3)),c();else{const m=await o.text(),H=JSON.parse(m);throw new Error(`${H.error}`)}}catch(o){y("error",`${o.message}`),c()}finally{b(!1)}}};return e.jsxs(L.Provider,{value:F,children:[e.jsx("div",{children:d&&e.jsxs("div",{className:"fixed top-0 left-0 w-full right-0 bg-black/40 z-[4000] h-full flex place-items-center place-content-center",onClick:()=>s(!1),children:[e.jsx(fe,{setDialog:s}),e.jsx("div",{className:"mx-3 w-full",children:e.jsxs("div",{className:"max-w-[600px] mx-auto w-full bg-white rounded-[40px] px-[24px] pt-16 relative pb-12",onClick:l=>l.stopPropagation(),children:[e.jsx("div",{className:"absolute top-8 right-8 text-3xl border-[2px] rounded-xl border-gray-500/20 w-[40px] h-[40px] shadow-sm flex place-items-center place-content-center text-gray-500 cursor-pointer hover:bg-gray-100 hover:border-gray-200/50",onClick:()=>s(!1),children:e.jsx(K,{})}),e.jsxs("div",{className:"text-3xl font-semibold",children:[r===null?"Add":"Edit"," Service"]}),e.jsx("div",{className:"border rounded-2xl overflow-hidden pl-3 pt-3 mt-4",children:e.jsx("div",{className:"mt-0  h-[430px] overflow-x-hidden overflow-y-scroll pr-3",children:e.jsxs("form",{className:"w-full ",onSubmit:J(O),children:[e.jsx(G,{controlTitle:"Service name",controlPlaceholder:"Enter service name",controlName:"service_name",register:N,changeHandler:w,error:U.service_name,controlInformation:"Enter a service name. "}),e.jsx(le,{controlTitle:"Service Description",controlPlaceholder:"Service description",controlName:"service_description",register:N,changeHandler:w,error:U.service_description,setValue:_,getValues:$,watch:W,controlInformationClass:ce,controlInformation:"Service description for this business activities"}),e.jsx(G,{controlTitle:"Service URL",controlPlaceholder:"Enter a valid url",controlName:"service_url",register:N,changeHandler:w,error:U.service_url,controlInformation:"Your url should start like this: http://example.com "}),e.jsx(ae,{working:T})]})})}),r!==null&&e.jsx("div",{className:"flex flex-col",onClick:()=>z(r==null?void 0:r.service_guid),children:e.jsx("div",{className:"py-4 underline text-xl  cursor-pointer",children:"Delete Service"})})]})})]})}),t]})},fe=({setDialog:t})=>e.jsx("div",{onClick:()=>t(!1),children:e.jsx("div",{className:"w-[30px] h-[30px] flex place-items-center place-content-center rounded-full absolute top-2 left-2 bg-white text-[25px] font-bold transition-all ease-in-out duration-700 cursor-pointer hover:bg-white/40",children:e.jsx(X,{})})}),xe=de({service_name:I({message:"Please enter a service name"}).min(1,{message:"Please enter a service name"}),service_description:I({message:"Please enter a service description"}).min(1,{message:"Please enter a service description"}),service_url:I().nullable().optional().refine(t=>{if(!t||t===""||t===void 0)return!0;try{return new URL(t),!0}catch{return!1}},{message:"Please enter a valid URL. Example: http://example.com/service-link"})}),Je=()=>{i.useEffect(()=>{Z(localStorage)},[]);const[t,d]=i.useState(""),[s,g]=i.useState(""),[a,E]=i.useState(!0),[p,r]=i.useState(null),{business_guid:n,user_guid:f}=M(),[x,T]=i.useState(null),[b,h]=i.useState(null),[j,y]=i.useState(null);oe();const[D]=Q();return i.useEffect(()=>{const A=async(c,P,k)=>{d(c),g(P);const O=await ee(c||""),w=await se(c,P,k),N=w.data||[];y(w.pagination),console.log(w),T(O),r(N)};try{if(n&&f){const c=parseInt(D.get("page")||"1"),P=parseInt(D.get("limit")||"10");A(n,f,c)}}catch(c){console.log(c.message)}},[f,n]),i.useEffect(()=>{t&&s&&p&&x&&(h({businessGuid:t,userGuid:s,serviceList:p,businessProfile:x}),E(!1))},[t,s,p,x]),e.jsx(Y,{children:e.jsx(q,{title:"Services Settings",businessGuid:t,data:b,businessProfile:x,children:e.jsxs(pe,{children:[t&&s&&e.jsx(he,{userGuid:s,businessGuid:t}),j&&p&&t&&s&&e.jsx(ge,{pagination:j,serviceList:p,businessGuid:t,userGuid:s})]})})})},he=({userGuid:t,businessGuid:d})=>{const s=R(),g=()=>{s==null||s.setDialog(!0),s==null||s.setUserGuid(t),s==null||s.setBusinessGuid(d),s==null||s.setServiceProfile(null)};return e.jsx("div",{className:"mb-2",children:e.jsx("button",{onMouseDown:g,className:` bg-blue-800 rounded-md px-3 py-1
                text-white hover:bg-blue-700 transition
                duration-500 ease-in-out hover:shadow-md
                 shadow-gray-900 hover:shadow-black/50`,children:"Add Service"})})},ge=({pagination:t,serviceList:d,businessGuid:s,userGuid:g})=>{const a=R(),[E,p]=i.useState(!1),r=async n=>{a==null||a.setDialog(!0),a==null||a.setBusinessGuid(s),a==null||a.setUserGuid(g);const f=await re(n);a==null||a.setServiceProfile(f),p(!0)};return i.useEffect(()=>{d&&console.log(d)},[d]),e.jsxs("div",{children:[e.jsxs("div",{className:"mt-6 flex flex-col border rounded-xl overflow-hidden relative",children:[e.jsxs("div",{className:"flex flex-row gap-0 p-3 text-lg font-bold gap-x-2",children:[e.jsx("div",{className:"min-w-[200px] w-[200px]",children:"Service Name"}),e.jsx("div",{className:"grow ",children:"Service Description"})]}),d==null?void 0:d.map((n,f)=>{const x=f%2===0;return e.jsxs("div",{onClick:()=>r(n==null?void 0:n.service_guid),className:` flex flex-row place-items-center relative ${x&&"bg-gray-100"} border-t py-2 px-3 cursor-pointer gap-x-2`,children:[e.jsx("div",{className:"min-w-[200px] w-[200px] text-base first:border-none line-clamp-1",children:n==null?void 0:n.service_name}),e.jsx("div",{className:"grow w-full line-clamp-1 text-base",children:te(n==null?void 0:n.service_description)})]},f)})]}),e.jsx("div",{className:"mt-6",children:t&&e.jsx(me,{pagination:t})})]})};export{Je as default};
