import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-QUucBwvO.js";import{A}from"./AccountLayout-B3DB5m1P.js";import{u as C}from"./AuthContext-DsSG-Uaz.js";import{t as I,J as O,K as T,o as k}from"./lib-DEOwUPv8.js";import{u as U,a as W}from"./zod-BgOlUoe_.js";import{B as _}from"./Button-7Woa2p3a.js";import{I as q}from"./Input-DzowP9zj.js";import{o as B,s as F}from"./types-DBTFAyTi.js";import{f as R,g as V}from"./css-CVxtJxAn.js";import{u as J}from"./NotificationContext-Cqdqo973.js";import{u as H}from"./OperationContext-C6xAhjBF.js";import{P as K}from"./ProfileContentLayout-BhBZiNC3.js";import{L as M}from"./LoadingMessage-BIfhbO4x.js";import"./AccountUserImage-7182FjmH.js";import"./HomeNav-CKU0Hu2T.js";import"./MainNav-CF7yZDe8.js";import"./index-DfiToR9F.js";import"./BusinessMenu-CFqWD6in.js";const $=B({email:F({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),z=({loaderData:r,user:s})=>{var E,w;const[i,p]=t.useState(null),[a,n]=t.useState(!1);J();const[g,x]=t.useState(!0),{showOperation:c,showSuccess:l,showError:m,showWarning:D,showInfo:G,completeOperation:f}=H(),S=o=>{let j=o.target.value,h=o.target.name;p(d=>({...d,[h]:j}))},y=async o=>{var d,b;if(n(!0),c("processing"),await new Promise(u=>setTimeout(u,1e3)),o.email===((d=r.userProfile)==null?void 0:d.email))return m("Error","Email is in use. Enter a new email."),f(),n(!1),!1;const h=O.BASE_URL+"/api/user/change_email_request";o.guid=(b=r.userProfile)==null?void 0:b.user_guid;try{const u=await fetch(h,{method:"POST",headers:I,body:JSON.stringify(o)});if(u.ok)l("Success","Please check your new email to continue."),f();else{let se=u.json().then(L=>{m("Error",L.message),f()})}}catch{m("Error","Change request failed"),f()}finally{n(!1)}},{register:P,handleSubmit:v,getValues:Q,setValue:X,watch:Y,setError:Z,formState:{errors:N,isSubmitting:ee}}=U({defaultValues:r.listing,resolver:W($)});return e.jsx("form",{onSubmit:v(y),children:e.jsx("div",{className:`${R} mt-0  rounded-lg pt-4
                             max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:V,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Current email"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsxs("span",{className:" font-semibold",children:["[",(E=r.userProfile)==null?void 0:E.email,"]"]})," will be used for account-related notifications and can be used for password resets."]}),e.jsxs("div",{className:"border-[1px] rounded-full px-3 py-3 bg-gray-50",children:[(w=r.userProfile)==null?void 0:w.email," Â "]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(q,{controlTitle:"Update Email",controlPlaceholder:"Enter new email address",controlName:"email",register:P,changeHandler:S,error:N.email,width:100,controlInformation:"Enter a new email address."}),e.jsx(_,{working:a})]})})})},be=()=>{t.useEffect(()=>{T(localStorage)},[]);const r=C();if(!r)return null;const{user:s}=r,[i,p]=t.useState(null),[a,n]=t.useState(null),[g,x]=t.useState(!0);return t.useEffect(()=>{async function c(l){const m=await k(l||"");p(m)}try{s!=null&&s.guid&&c(s==null?void 0:s.guid)}catch(l){console.log(l.message)}},[s==null?void 0:s.guid]),t.useEffect(()=>{i&&n({userProfile:i})},[i]),t.useEffect(()=>{a&&x(!1)},[a]),g?e.jsx(M,{loading:g}):e.jsx(A,{children:e.jsxs(K,{title:"Email Address",children:[i===null?"Loading...":"",e.jsx("div",{className:"font-semibold mb-2 text-md"}),a&&e.jsx(z,{loaderData:a,user:s})]})})};export{be as default};
