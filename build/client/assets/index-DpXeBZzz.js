import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as a}from"./components-DGrJwBOK.js";import{A as T}from"./AccountLayout-vMGD-re6.js";import{u as A}from"./AuthContext-Co5AyISc.js";import{t as I,f as L,aa as R,D as U}from"./lib-7lwFdP97.js";import{u as O,a as V}from"./zod-MdMXX0Ui.js";import{B as k}from"./Button-7Woa2p3a.js";import{I as j}from"./Input-zq_wX72w.js";import{o as B,s as y,Z as S}from"./types-DBTFAyTi.js";import{f as D,g as F}from"./css-CVxtJxAn.js";import{u as W}from"./NotificationContext-DISiBD6S.js";import{u as Z}from"./OperationContext-Cntcaxvx.js";import{P as _}from"./ProfileContentLayout-DdpB7O3c.js";import{L as $}from"./LoadingMessage-uYfV-qmv.js";import"./LeftNav-C8z2o6Gi.js";import"./HomeNav-CYH_vM2g.js";import"./MainNav-Bxi2hJBV.js";import"./index-CM5QHmZM.js";import"./BusinessMenu-3N-i86gd.js";const b=new RegExp(/^(?=.*?[A-Z])(?=.*?[a-z])(?=.*?[0-9])(?=.*?[#?!()Â£@$%^&*-]).{8,}$/),q=B({oldpassword:y().min(1,{message:"Please enter old password."}).min(8,{message:"Password must be up to 8 characters."}).regex(b,{message:"Please enter a valid password"}),newpassword:y().min(1,{message:"Please enter new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(b,{message:"Please enter a valid password"}),newpassword2:y().min(1,{message:"Please retype new password."}).min(8,{message:"Password must be at least 8 characters."}).regex(b,{message:"Please enter a valid password"})}).superRefine((r,e)=>{r.oldpassword===r.newpassword&&e.addIssue({code:S.custom,path:["newpassword"],message:"New password cannot be the same as old password"}),r.newpassword!==r.newpassword2&&e.addIssue({code:S.custom,path:["newpd2"],message:"Your new password don't match"})}),z=({loaderData:r,user:e})=>{var E;const[i,f]=a.useState(null),[t,p]=a.useState(!1);W();const{showOperation:m,showError:w,completeOperation:n,showSuccess:d}=Z(),c=o=>{let x=o.target.value,P=o.target.name;f(u=>({...u,[P]:x}))},N=async o=>{var u;p(!0),m("processing"),await new Promise(l=>setTimeout(l,1e3));const x="/api/user/change_password/"+((u=r.userProfile)==null?void 0:u.user_guid),P=L.BASE_URL+x;o.password=o==null?void 0:o.newpassword,delete o.oldpassword,delete o.newpassword,delete o.newpassword2;try{const l=await fetch(P,{method:"PUT",headers:I,body:JSON.stringify(o)});if(l.ok)d("Success","Password changed. Use new password on next login."),n();else{let K=l.json().then(C=>{w("Error",C.message),n()})}}catch(l){console.log(l.message),w("Error","Password change failed."),n()}finally{p(!1)}},{register:g,handleSubmit:v,getValues:H,setValue:J,watch:M,setError:Y,formState:{errors:h,isSubmitting:G}}=O({defaultValues:r.listing,resolver:V(q)});return s.jsx("form",{onSubmit:v(N),children:s.jsx("div",{className:`${D} mt-0  
            rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:s.jsxs("div",{className:F,children:[s.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Change Password"}),s.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[s.jsx("b",{children:(E=r.userProfile)==null?void 0:E.email})," is your current email. It will be used be used for password resets or changes."]}),s.jsx("div",{className:"mt-[20px]"}),s.jsx(j,{controlTitle:"Current Password",controlPlaceholder:"Enter current password",controlType:"password",controlName:"oldpassword",register:g,changeHandler:c,error:h.oldpassword}),s.jsx(j,{controlTitle:"New Password",controlType:"password",controlPlaceholder:"Enter new password",controlName:"newpassword",register:g,changeHandler:c,error:h.newpassword}),s.jsx(j,{controlTitle:"Retype New Password",controlPlaceholder:"Retype new password",controlName:"newpassword2",controlType:"password",register:g,changeHandler:c,error:h.newpassword2}),s.jsx(k,{working:t})]})})})},he=()=>{a.useEffect(()=>{R(localStorage)},[]);const r=A();if(!r)return null;const{user:e}=r,[i,f]=a.useState(null),[t,p]=a.useState(null),[m,w]=a.useState(!0);return a.useEffect(()=>{async function n(d){const c=await U(d||"");f(c)}try{e!=null&&e.guid&&n(e==null?void 0:e.guid)}catch(d){console.log(d.message)}},[e==null?void 0:e.guid]),a.useEffect(()=>{if(i&&e){const n={userProfile:i,...e};p(n)}},[i,e]),a.useEffect(()=>{t&&w(!1)},[t]),m?s.jsx($,{loading:m}):s.jsx(T,{children:s.jsxs(_,{title:"Change Password",data:t,children:[i===null?"Loading...":"",t&&s.jsx(z,{loaderData:t,user:e})]})})};export{he as default};
