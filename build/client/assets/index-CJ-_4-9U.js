import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,e as B}from"./components-CqyJs_9b.js";import{a9 as C,l as U,ad as O}from"./lib-d-OCgvip.js";import{A as P}from"./AccountLayout-QOHrx1by.js";import{C as $}from"./ContentLayout-SpVwgp8S.js";import{u as R}from"./AuthContext-BH94oN1s.js";import{u as k}from"./OperationContext-BdFCpeXF.js";import{L as I}from"./LoadingMessage-B9wZrrAy.js";import"./LeftNav-Cj9_gra7.js";import"./HomeNav-C5gVOegL.js";import"./MainNav-oY7cNyR2.js";import"./index-CTCnFI3k.js";import"./BusinessMenu-CYgnqm1J.js";import"./BusinessDrawer-_Mi3vA0Y.js";function T({userGuid:y}){const[x,f]=t.useState(""),[l,a]=t.useState([]),[c,d]=t.useState(null),[w,m]=t.useState(""),[p,i]=t.useState([]),[g,j]=t.useState(null),{showOperation:b,showError:o,completeOperation:h,showSuccess:S}=k(),N=async e=>{if(f(e),e.length<2)return a([]);const r=await(await fetch(`/api/listing/business_single_search?q=${encodeURIComponent(e)}&user_guid=${y}`)).json();a(r)},_=async e=>{if(m(e),e.length<2)return i([]);const r=await(await fetch(`/api/listing/user_single_search?q=${encodeURIComponent(e)}`)).json();i(r)},E=async()=>{if(b("processing"),!g||!c){o("Error","Please select both a user and a business before submitting."),h();return}await new Promise(u=>setTimeout(u,1e3));const e=JSON.parse(JSON.stringify(g)),n=JSON.parse(JSON.stringify(c)),r={user_guid:e.user_guid,previous_owner_guid:n.owner,business_guid:n.gid};console.log(e),console.log(n),console.log(r);try{const u=await fetch("/api/listing/reassign_business",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(r)});if(!u.ok){const v=await u.text();console.error("Error response:",v),o("Error",`${v}`),h();return}const A=await u.json();S("Success","Business reassigned successfully!"),h()}catch(u){console.error("Request failed:",u),o("Error","Something went wrong while reassigning."),h()}};return s.jsxs("div",{className:"space-y-6 p-4 max-w-lg",children:[s.jsxs("div",{className:"relative",children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search Business"}),s.jsx("input",{id:"biz",type:"text",value:x,onChange:e=>N(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"Type business name..."}),l.length>0&&s.jsx("ul",{className:"border mt-2 rounded bg-white shadow divide-y",children:l==null?void 0:l.map((e,n)=>{const r=n%2===0;return s.jsx("li",{onClick:()=>{d(e),a([]),f(e.title)},className:`${r?"bg-gray-50":"bg-white"} p-2 cursor-pointer hover:bg-gray-100`,children:e.title},e.id)})}),c&&s.jsx("input",{type:"hidden",name:"businessId",value:c.id})]}),s.jsxs("div",{className:"relative w-full",children:[s.jsx("label",{className:"block text-sm font-medium mb-1",children:"Search User"}),s.jsx("input",{id:"user",type:"text",value:w,onChange:e=>_(e.target.value),className:"w-full border rounded px-3 py-2",placeholder:"Type user name..."}),p.length>0&&s.jsx("ul",{className:"absolute border mt-2 rounded bg-white shadow divide-y w-full max-h-[200px] overflow-y-auto",children:p.map((e,n)=>{const r=n%2===0;return s.jsxs("li",{onClick:()=>{j(e),i([]),m(`${e.first_name}, ${e.lastname}`)},className:`${r?"bg-gray-50":"bg-white"} p-2 cursor-pointer hover:bg-gray-100`,children:[e.first_name,", ",e.lastname]},e.id)})}),g&&s.jsx("input",{type:"hidden",name:"userId",value:g.id})]}),s.jsx("button",{type:"submit",onClick:E,className:"px-4 py-2 bg-blue-600 text-white rounded hover:bg-blue-700",children:"Submit"})]})}const Z=()=>{t.useEffect(()=>{C(localStorage)},[]);const[y,x]=t.useState(!0),[f,l]=t.useState(null),[a,c]=t.useState(""),[d,w]=t.useState(""),{business_guid:m,user_guid:p}=B(),[i,g]=t.useState(null);return R()?(t.useEffect(()=>{const b=async(o,h)=>{c(o),w(h);const S=await O(o||"");g(S)};try{m&&p&&b(m,p)}catch(o){U(o)}},[m,p]),t.useEffect(()=>{a&&d&&i&&(l({businessGuid:a,userGuid:d,businessProfile:i}),x(!1))},[a,d,i]),y?s.jsx(I,{}):s.jsx(P,{children:s.jsx($,{title:"Delete Business Profile",businessGuid:a,data:f,businessProfile:i,children:f&&s.jsx(T,{userGuid:d})})})):null};export{Z as default};
