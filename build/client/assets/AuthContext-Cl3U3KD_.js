import{j as v}from"./jsx-runtime-0DLF9kdB.js";import{r as l,a as x}from"./components-QUucBwvO.js";import{t as m}from"./lib-CWKz2Rp4.js";const p=l.createContext(null),d="https://index.bycet.com";function J(){const i=l.useContext(p);return i||null}function _({children:i}){let[E,r]=l.useState(null),[g,a]=l.useState(null);const h=async t=>{try{let s=d+"/api/user/verifytoken";const e=await fetch(s,{method:"POST",headers:m,body:JSON.stringify({token:t})});if(e.status!==200)throw new Error("Could not obtain token");return await e.json()}catch(n){return console.log(n.message),null}};l.useEffect(()=>{const t=localStorage.getItem("authTokens");if(t!==null){const e=JSON.parse(t);r(e)}if(t===null&&r(null),t){const u=JSON.parse(t).accessToken;h(u).then(o=>{o===null?(r(null),a(null),localStorage.removeItem("authTokens")):a(o)})}else a(null);S(!1);let n=1e3*60*60*12,s=setInterval(()=>{f()},n);return()=>clearInterval(s)},[]);let[T,S]=l.useState(!0);const k=d+"/api/user/signin";x();let w=async t=>{try{const n=await fetch(k,{method:"POST",headers:m,body:JSON.stringify(t)});let s=await n.json();return n.status===200?(r(s),h(s.accessToken).then(e=>{a(e)}),localStorage.setItem("authTokens",JSON.stringify(s)),new Promise(e=>{setTimeout(()=>{e(!0)},100)})):new Promise(e=>{setTimeout(()=>{e(s)},100)})}catch{return new Promise(s=>{setTimeout(()=>{s(!1)},100)})}};const f=()=>{r(null),a(null),localStorage.removeItem("authTokens")};let y={user:g,signin:w,signoutNoReload:f,signoutReload:()=>{r(null),a(null),localStorage.removeItem("authTokens"),window.location.reload()},resetpw:async t=>{const e="https://index.bycet.com"+"/api/user/reset_password_request";try{const o=await fetch(e,{method:"POST",headers:m,body:JSON.stringify(t)});var u=await o.json();if(o.ok)return new Promise(c=>{setTimeout(()=>{c(u.message)},100)});throw new Error(`Error Code: ${o.status} - ${u.message}`)}catch(o){return new Promise(c=>{setTimeout(()=>{c(o.message)},100)})}finally{}}};return v.jsx(p.Provider,{value:y,children:T?null:i})}export{_ as A,J as u};
