import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as t}from"./components-CqyJs_9b.js";import{u as Q}from"./AuthContext-BH94oN1s.js";import{f as R,aW as Y,S as D,a7 as H,a8 as X,u as ee,a9 as te,L as se,aa as oe,ab as ae,a3 as ne,aX as re}from"./lib-d-OCgvip.js";import{u as G}from"./NotificationContext-CJEyd20o.js";import{u as J}from"./OperationContext-BdFCpeXF.js";import{u as le,a as ce}from"./zod-DwrW5z8F.js";import{o as ie,a as p,s as de}from"./types-DBTFAyTi.js";import{B as ue}from"./Button-7Woa2p3a.js";import{I as k}from"./Input-D3HOu0t0.js";import{S as $}from"./Select-BC9R8HZG.js";import{f as me}from"./css-CVxtJxAn.js";import{P as pe}from"./ProfileLayout-Dkl0s_uP.js";import{L as fe}from"./LoadingMessage-B9wZrrAy.js";import"./LeftNav-Cj9_gra7.js";import"./HomeNav-C5gVOegL.js";import"./MainNav-oY7cNyR2.js";import"./index-CTCnFI3k.js";const he=({user:i,userProfileImageData:a})=>{G();let s="";a!=null&&a.image_url&&(s=R.IMG_BASE_URL+a.image_url);const[f,S]=t.useState(s),[v,y]=t.useState(null),b=t.useRef(null),[N,U]=t.useState(!1),[h,E]=t.useState(!1),{showOperation:P,showSuccess:I,showError:l,showWarning:A,showInfo:j,completeOperation:g}=J(),C=()=>{var o;(o=b.current)==null||o.click()},r=o=>{var _;const n=(_=o.target.files)==null?void 0:_[0];if(n){const c=URL.createObjectURL(n);S(c),y(n),U(!0)}},d=async()=>{if(E(!0),P("processing"),await new Promise(o=>setTimeout(o,1e3)),N){const o=new FormData;o.append("file",v),o.append("guid",i.user_guid);const _=R.IMG_BASE_URL+"/user_profile_pic_upload";try{const c=await fetch(_,{method:"POST",body:o});if(c.ok)I("Success","Image uploaded."),g();else{let O=c.json().then(T=>{l("Error",T.message),g()})}}catch{l("Error","Image upload failed."),g()}finally{E(!1)}}else l("Error","Please select an image to continue"),g(),E(!1)};return e.jsxs("div",{className:`w-[50%] mx-auto flex flex-col 
        place-content-center place-items-center`,children:[e.jsxs("div",{className:`relative bg-black w-[150px] 
                h-[150px] z-40 rounded-full overflow-hidden
                flex place-content-center place-items-center border-[3px] border-white`,children:[f!==""?e.jsx("img",{src:f,alt:"",className:` object-cover w-full h-full z-0 absolute ${f===""?"bg-transparent":"bg-white"}`}):e.jsx(Y,{className:"object-cover w-[70%] h-[70%]"}),e.jsx("input",{type:"file",accept:"image/*",ref:b,className:" hidden",onChange:r}),e.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 
                                 top-0 object-cover
                                 text-white/80 `,onMouseDown:C,children:e.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    rounded-full transition duration-300 ease-in-out bg-white/50`,children:e.jsx(D,{className:" text-[30px]"})})})]}),e.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:e.jsx("button",{className:`
                        ${h?"bg-gray-200 cursor-default":"bg-blue-100"}  
                        w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out
                        px-5`,onMouseDown:d,disabled:h,children:h?"Uploading...":"Submit"})})]})},ge=ie({first_name:de().min(1,{message:"Enter a first name"}),lastname:p(),country_code:p(),state_code:p(),city_id:p(),phone:p(),address_one:p(),address_two:p(),country:p(),xsocial:p(),linksocial:p(),fbsocial:p(),zipcode:p()}),xe=({listing:i,user:a,userProfileBgData:s})=>{const[f,S]=t.useState(!1),[v,y]=t.useState(""),b=t.useRef(null),[N,U]=t.useState(!1);G();const[h,E]=t.useState(null),{showOperation:P,showError:I,completeOperation:l,showSuccess:A}=J();t.useEffect(()=>{s!=null&&s.image_url&&y(R.IMG_BASE_URL+(s==null?void 0:s.image_url))},[]);const j=()=>{var r;(r=b.current)==null||r.click()},g=r=>{var o;const d=(o=r.target.files)==null?void 0:o[0];if(d){const n=URL.createObjectURL(d);y(n),E(d),U(!0)}},C=async()=>{S(!0),P("processing"),await new Promise(d=>setTimeout(d,1e3));const r=new FormData;if(N){r.append("file",h),r.append("guid",a.user_guid);const o=R.IMG_BASE_URL+"/user_profile_bg_upload";try{const n=await fetch(o,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:r});if(n.ok)try{A("Success","Image saved.")}finally{l()}else{let _=n.json().then(c=>{console.log(c.message),I("Error",c.message),l()})}}catch(n){console.log(n),I("Error","Image save failed"),l()}finally{S(!1)}}else I("Error","Please select an image to continue."),l(),S(!1)};return e.jsxs("div",{className:"relative",children:[e.jsxs("div",{className:"bg-gray-700 w-full h-[200px] relative shadow-lg text-white flex place-items-center place-content-center flex-col",children:[v===""&&"Add Photo (1920x200)",v&&e.jsx("img",{src:v,alt:"",className:"object-cover w-full h-full absolute"}),e.jsx("input",{type:"file",accept:"image/*",ref:b,className:" hidden",onChange:g})]}),e.jsxs("div",{className:` flex place-items-center gap-1.5
                place-content-center top-[5px] right-[5px] w-fit z-[120] absolute`,children:[e.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:f,onMouseDown:j,children:"Browse"}),e.jsx("button",{className:`bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:C,disabled:f,children:f?"Uploading...":"Upload"})]})]})},we=({loaderData:i,user:a,userProfileData:s,userProfileBgData:f})=>{var V,q;const[S,v]=t.useState(null),[y,b]=t.useState(!1);G();const N=i.countries;let[U,h]=t.useState(i.states),[E,P]=t.useState(i.cities);i.categories;const[I,l]=t.useState((V=i.userProfileData)==null?void 0:V.country_code),[A,j]=t.useState((q=i.userProfileData)==null?void 0:q.state_code),[g,C]=t.useState(""),[r,d]=t.useState(""),{showOperation:o,showError:n,completeOperation:_,showSuccess:c}=J(),O=async u=>{l(u),C(u);const L=await H(u);h(L),T("")},T=async u=>{j(u),d(u);const L=await X(I,u);P(L)},x=u=>{let L=u.target.value,B=u.target.name;v(W=>({...W,[B]:L}))},F=async u=>{b(!0),o("processing"),await new Promise(m=>setTimeout(m,1e3));const L="https://test.ashthor.com",B="/api/user/"+a.guid,W=L+B;try{const m=await fetch(W,{method:"PUT",headers:ee,body:JSON.stringify(u)});if(m.ok)c("Success","Updated."),_();else{var K=await m.json();throw new Error(`Error Code: ${m.status} - ${K.error}`)}}catch(m){n("Error",(m==null?void 0:m.message)||(m==null?void 0:m.error)||"Update failed."),_();return}finally{b(!1)}},{register:w,handleSubmit:Z,getValues:Se,setValue:M,watch:ye,setError:be,formState:{errors:z,isSubmitting:je}}=le({defaultValues:s,resolver:ce(ge)});return t.useEffect(()=>{g&&(M("state_code",""),M("city_id",""))},[g]),t.useEffect(()=>{r&&M("city_id","")},[r]),e.jsxs("div",{children:[e.jsx(xe,{user:s,userProfileBgData:f}),e.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:e.jsx("div",{className:"absolute top-[-50px]",children:e.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:e.jsx(he,{user:s,userProfileImageData:i.userProfileImageData})})})}),e.jsxs("div",{className:"px-[15px]",children:[e.jsx("hr",{}),e.jsx("form",{onSubmit:Z(F),children:e.jsxs("div",{className:`${me} mt-0  rounded-lg pt-4
                 md:max-w-[600px] w-full mx-auto `,children:[e.jsxs("div",{className:"text-xl font-[600] leading-[1.4em] px-[10px] text-black mb-[32px]",children:[s==null?void 0:s.first_name," ",s==null?void 0:s.lastname]}),e.jsx(k,{controlTitle:"First Name",controlName:"first_name",controlPlaceholder:"Enter first name",register:w,changeHandler:x,error:z.first_name,controlInformation:"Please enter your first name. First name is compulsory. "}),e.jsx(k,{controlTitle:"Last Name",controlName:"lastname",controlPlaceholder:"Enter last name",register:w,changeHandler:x,error:z.lastname,controlInformation:"Please enter your last name. Last name is compulsory. "}),e.jsx($,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select Country",selectJson:N,register:w,changeHandler:x,error:z.country_code,setCode:O,controlInformation:"Please select country. "}),e.jsx($,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select State",selectJson:U,register:w,changeHandler:x,setCode:T,controlInformation:"Please select state. "}),e.jsx($,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select City",selectJson:E,register:w,changeHandler:x,controlInformation:"Please select a city. "}),e.jsx(k,{controlTitle:"Zipcode",controlName:"zipcode",controlPlaceholder:"Enter zip code",register:w,changeHandler:x,controlInformation:"Please a zipcode. "}),e.jsx(k,{controlTitle:"Phone",controlName:"phone",controlPlaceholder:"Enter phone number",register:w,changeHandler:x,controlInformation:"Please enter a phone or mobile. "}),e.jsx(k,{controlTitle:"Address Line 1",controlName:"address_one",controlPlaceholder:"Enter address",register:w,changeHandler:x,controlInformation:"Please enter an address. "}),e.jsx(k,{controlTitle:"Address Line 2",controlName:"address_two",controlPlaceholder:"Enter address",register:w,changeHandler:x,controlInformation:"E.g. Off Brian's Boulevard or Avenue. "}),e.jsx(ue,{working:y})]})})]})]})},We=()=>{const i=Q();if(!i)return null;const{user:a}=i;te(localStorage);const[s,f]=t.useState(null),[S,v]=t.useState(null),[y,b]=t.useState(null),[N,U]=t.useState(null),[h,E]=t.useState(null),[P,I]=t.useState(null),[l,A]=t.useState(null),[j,g]=t.useState(null),[C,r]=t.useState(!0);return t.useEffect(()=>{async function d(o){try{const n=await se(o||""),_=await oe(),c=n,O=await H(c.country_code||""),T=await X(c.country_code||"",c.state_code||""),x=await ae(),F=await ne(o||""),w=await re(o||"");f(n),b(_),v(O),U(T),E(F),I(w),A(x)}catch(n){console.log(n.message)}}a!=null&&a.guid&&d(a==null?void 0:a.guid)},[a==null?void 0:a.guid]),t.useEffect(()=>{s&&y&&S&&N&&h&&l&&g({userProfile:s,countries:y,states:S,cities:N,userProfileImageData:h,categories:l})},[l,y,S,N,h,s]),t.useEffect(()=>{j&&r(!1)},[j]),C?e.jsx(fe,{loading:C}):e.jsx(pe,{children:s&&j&&!C&&a&&e.jsx(we,{loaderData:j,user:a,userProfileData:j.userProfile,userProfileBgData:P})})};export{We as default};
