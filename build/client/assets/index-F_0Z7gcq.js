import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as o,e as Q,a as q}from"./components-CqyJs_9b.js";import{A as K}from"./AccountLayout-QOHrx1by.js";import{C as X}from"./ContentLayout-SpVwgp8S.js";import{Q as Y,B as Z,u as G,f as I,a9 as ee,ad as se,ag as te,ah as oe,r as re,ai as ie}from"./lib-d-OCgvip.js";import{u as ne}from"./AuthContext-BH94oN1s.js";import{P as ae}from"./Pagination-DIrFETbL.js";import{u as le,a as ce}from"./zod-DwrW5z8F.js";import{B as ue}from"./Button-7Woa2p3a.js";import{T as de}from"./TextareaWithWordLimit-DQRzKMej.js";import{c as me}from"./css-CVxtJxAn.js";import{u as pe}from"./OperationContext-BdFCpeXF.js";import{S as fe}from"./Select-BC9R8HZG.js";import{o as ge,s as F}from"./types-DBTFAyTi.js";import"./LeftNav-Cj9_gra7.js";import"./HomeNav-C5gVOegL.js";import"./MainNav-oY7cNyR2.js";import"./index-CTCnFI3k.js";import"./BusinessMenu-CYgnqm1J.js";import"./BusinessDrawer-_Mi3vA0Y.js";const R=o.createContext(null),$=()=>{const n=o.useContext(R);return n||null},he=({children:n})=>{const[p,l]=o.useState(!1),[v,t]=o.useState(""),[i,f]=o.useState(""),[s,h]=o.useState(null),[a,u]=o.useState(null),[j,x]=o.useState(null),[E,P]=o.useState(!1);o.useEffect(()=>{s!==null&&V(s),s===null&&(C("facility_id",""),C("facility_description",""))},[s]);const{showOperation:w,showSuccess:y,showError:D,showWarning:A,showInfo:O,completeOperation:d}=pe(),T=async c=>{const b=I.BASE_URL+"/api/listing/facilities";try{const m=await fetch(b,{method:"POST",headers:G,body:JSON.stringify(c)});if(m.ok)y("Success","Service added successfully."),await new Promise(r=>setTimeout(r,2e3)),w("processing","Reloading..."),await new Promise(r=>setTimeout(r,3e3)),window.location.reload(),await new Promise(r=>setTimeout(r,3e3)),d();else{const r=await m.text(),g=JSON.parse(r);throw new Error(`${g.error}`)}}catch(m){D("error",`${m.message}`),d()}finally{P(!1)}},k=async c=>{const S="/api/listing/facilities/"+(s==null?void 0:s.facility_guid),b=I.BASE_URL+S;try{const m=await fetch(b,{method:"PUT",headers:G,body:JSON.stringify(c)});if(m.ok)y("Success","Facility UPDATED successfully."),await new Promise(r=>setTimeout(r,2e3)),w("processing","Reloading..."),await new Promise(r=>setTimeout(r,3e3)),window.location.reload(),await new Promise(r=>setTimeout(r,3e3)),d();else{const r=await m.text(),g=JSON.parse(r);throw new Error(`${g.error}`)}}catch(m){D("error",`${m.message}`),d()}finally{P(!1)}},B=async c=>{P(!0),s===null?w("processing","Adding service..."):w("processing","Updating service..."),await new Promise(S=>setTimeout(S,1e3)),s===null?(c.user_guid=v,c.business_guid=i,JSON.parse(JSON.stringify(c)),T(c)):k(c)},_=c=>{let S=c.target.value,b=c.target.name;x(m=>({...m,[b]:S}))},{register:N,handleSubmit:U,getValues:W,setValue:C,watch:L,reset:V,setError:be,formState:{errors:J,isSubmitting:je}}=le({defaultValues:s,resolver:ce(we)});let M={setDialog:l,setUserGuid:t,setBusinessGuid:f,setFacilityProfile:h,setSysFacilities:u};const z=async c=>{if(confirm("Do you wish to delete this service. Once deleted, you cannot recover it?")===!0){w("processing","Deleting service..."),await new Promise(r=>setTimeout(r,2e3));const b="/api/listing/services/"+(s==null?void 0:s.facility_guid),m=I.BASE_URL+b;try{const r=await fetch(m,{method:"DELETE",headers:G});if(r.ok)y("Success","Service DELETED successfully."),await new Promise(g=>setTimeout(g,2e3)),w("processing","Reloading..."),await new Promise(g=>setTimeout(g,3e3)),window.location.reload(),await new Promise(g=>setTimeout(g,3e3)),d();else{const g=await r.text(),H=JSON.parse(g);throw new Error(`${H.error}`)}}catch(r){D("error",`${r.message}`),d()}finally{P(!1)}}};return e.jsxs(R.Provider,{value:M,children:[e.jsx("div",{children:p&&e.jsxs("div",{className:"fixed top-0 left-0 w-full right-0 bg-black/40 z-[4000] h-full flex place-items-center place-content-center",onClick:()=>l(!1),children:[e.jsx(xe,{setDialog:l}),e.jsx("div",{className:"mx-3 w-full",children:e.jsxs("div",{className:"max-w-[600px] mx-auto w-full bg-white rounded-[40px] px-[24px] pt-16 relative pb-12",onClick:c=>c.stopPropagation(),children:[e.jsx("div",{className:"absolute top-8 right-8 text-3xl border-[2px] rounded-xl border-gray-500/20 w-[40px] h-[40px] shadow-sm flex place-items-center place-content-center text-gray-500 cursor-pointer hover:bg-gray-100 hover:border-gray-200/50",onClick:()=>l(!1),children:e.jsx(Y,{})}),e.jsxs("div",{className:"text-3xl font-semibold",children:[s===null?"Add":"Edit"," Facility"]}),e.jsx("div",{className:"border rounded-2xl overflow-hidden pl-3 pt-3 mt-4",children:e.jsx("div",{className:"mt-0  h-[330px] overflow-x-hidden overflow-y-scroll pr-3",children:e.jsxs("form",{className:"w-full ",onSubmit:U(B),children:[e.jsx(fe,{controlTitle:"Facility Name",controlName:"facility_id",controlPlaceholder:"Select Facility",selectJson:a,register:N,changeHandler:_,error:J.category,controlInformation:"Select facility to add to the business."}),e.jsx(de,{controlTitle:"Facility Description",controlPlaceholder:"Facility description",controlName:"facility_description",register:N,changeHandler:_,error:J.facility_description,setValue:C,getValues:W,watch:L,controlInformationClass:me,controlInformation:"Service description for this business activities"}),e.jsx(ue,{working:E})]})})}),s!==null&&e.jsx("div",{className:"flex flex-col",onClick:()=>z(s==null?void 0:s.facility_guid),children:e.jsx("div",{className:"py-4 underline text-xl  cursor-pointer",children:"Delete Facility"})})]})})]})}),n]})},xe=({setDialog:n})=>e.jsx("div",{onClick:()=>n(!1),children:e.jsx("div",{className:"w-[30px] h-[30px] flex place-items-center place-content-center rounded-full absolute top-2 left-2 bg-white text-[25px] font-bold transition-all ease-in-out duration-700 cursor-pointer hover:bg-white/40",children:e.jsx(Z,{})})}),we=ge({facility_id:F({message:"Please enter a service name"}).min(1,{message:"Please enter a service name"}),facility_description:F({message:"Please enter a facility description"}).min(1,{message:"Please enter a service description"})}),Le=()=>{o.useEffect(()=>{ee(localStorage)},[]);const[n,p]=o.useState(""),[l,v]=o.useState(""),[t,i]=o.useState(!0),[f,s]=o.useState(null),[h,a]=o.useState(null),{business_guid:u,user_guid:j}=Q(),[x,E]=o.useState(null),[P,w]=o.useState(null),[y,D]=o.useState(null);ne();const[A]=q();return o.useEffect(()=>{const O=async(d,T,k)=>{p(d),v(T);const B=await se(d||""),_=await te(),N=await oe(d,T,k),U=N.data||[];D(N.pagination),console.log(N),E(B),s(U),a(_)};try{if(u&&j){const d=parseInt(A.get("page")||"1"),T=parseInt(A.get("limit")||"10");O(u,j,d)}}catch(d){console.log(d.message)}},[j,u]),o.useEffect(()=>{n&&l&&f&&x&&(w({businessGuid:n,userGuid:l,facilityList:f,businessProfile:x}),i(!1))},[n,l,f,x]),e.jsx(K,{children:e.jsx(X,{title:"Facilities Settings",businessGuid:n,data:P,businessProfile:x,children:e.jsxs(he,{children:[n&&l&&e.jsx(ve,{userGuid:l,businessGuid:n,facilityList:f,sysFacilities:h}),y&&f&&n&&l&&e.jsx(Se,{pagination:y,facilityList:f,businessGuid:n,userGuid:l,sysFacilities:h})]})})})},ve=({userGuid:n,businessGuid:p,facilityList:l,sysFacilities:v})=>{const t=$();async function i(s,h){const a=new Set(s==null?void 0:s.map(u=>u.facility_id));return h==null?void 0:h.filter(u=>!a.has(u.id))}const f=async()=>{t==null||t.setDialog(!0),t==null||t.setUserGuid(n),t==null||t.setBusinessGuid(p),t==null||t.setFacilityProfile(null);const s=await i(l,v);t==null||t.setSysFacilities(s)};return e.jsx("div",{className:"mb-2",children:e.jsx("button",{onMouseDown:f,className:` bg-blue-800 rounded-md px-3 py-1
                text-white hover:bg-blue-700 transition
                duration-500 ease-in-out hover:shadow-md
                 shadow-gray-900 hover:shadow-black/50`,children:"Add Facility"})})},Se=({pagination:n,facilityList:p,businessGuid:l,userGuid:v,sysFacilities:t})=>{const i=$(),[f,s]=o.useState(!1),h=async a=>{i==null||i.setDialog(!0),i==null||i.setBusinessGuid(l),i==null||i.setUserGuid(v);const u=await ie(a);i==null||i.setFacilityProfile(u),i==null||i.setSysFacilities(t),s(!0)};return o.useEffect(()=>{p&&console.log(p)},[p]),e.jsxs("div",{children:[e.jsxs("div",{className:"mt-6 flex flex-col border rounded-xl overflow-hidden relative",children:[e.jsxs("div",{className:"flex flex-row gap-0 p-3 text-lg font-bold gap-x-2",children:[e.jsx("div",{className:"min-w-[200px] w-[200px]",children:"Facility Name"}),e.jsx("div",{className:"grow ",children:"Facility Description"})]}),p==null?void 0:p.map((a,u)=>{const j=u%2===0,x=t==null?void 0:t.find(E=>E.id===(a==null?void 0:a.facility_id));return e.jsxs("div",{onClick:()=>h(a==null?void 0:a.facility_guid),className:` flex flex-row place-items-center relative ${j&&"bg-gray-100"} border-t py-2 px-3 cursor-pointer gap-x-2`,children:[e.jsx("div",{className:"min-w-[200px] w-[200px] text-base first:border-none line-clamp-1",children:x==null?void 0:x.name}),e.jsx("div",{className:"grow w-full line-clamp-1 text-base",children:re(a==null?void 0:a.facility_description)})]},u)})]}),e.jsx("div",{className:"mt-6",children:n&&e.jsx(ae,{pagination:n})})]})};export{Le as default};
