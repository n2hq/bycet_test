import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as s}from"./components-QUucBwvO.js";import{A as R}from"./AccountLayout-E5HHg2_y.js";import{u as S}from"./AuthContext-BpdzroSL.js";import{a4 as P,K as A,o as L}from"./lib-B7Kpask5.js";import{u as T,a as C}from"./zod-BgOlUoe_.js";import{B as I}from"./Button-7Woa2p3a.js";import{I as O}from"./Input-osAm1V6g.js";import{o as W,s as D}from"./types-DBTFAyTi.js";import{f as F,g as V}from"./css-CVxtJxAn.js";import{u as k}from"./NotificationContext-B5ZIphkb.js";import{u as B}from"./OperationContext-C6xAhjBF.js";import{P as U}from"./ProfileContentLayout-Br2s6AjG.js";import{L as H}from"./LoadingMessage-BIfhbO4x.js";import"./AccountUserImage-TGkTW7ZP.js";import"./HomeNav-BQVoJKOS.js";import"./MainNav-DzPmQO3c.js";import"./index-vsv2yr5C.js";import"./BusinessMenu-DPyrZtg5.js";const J=W({email:D({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"})}),K=({loaderData:n,user:t})=>{var w;const[l,d]=s.useState(null),[o,m]=s.useState(!1);k();const r=S();if(!r)return null;const{showOperation:f,showError:u,completeOperation:a,showSuccess:p}=B(),j=g=>{let h=g.target.value,x=g.target.name;d(c=>({...c,[x]:h}))},y=async g=>{var c;m(!0),f("processing","Sending reset password email"),await new Promise(i=>setTimeout(i,1e3));const x={email:(c=r==null?void 0:r.user)==null?void 0:c.email.trim()};try{const i=await r.resetpw(x);JSON.stringify(i).includes("Error")?(m(!1),u("Error",P(i)),a()):(p("Success",P(i)),a(),await new Promise(N=>setTimeout(N,1e3)),m(!1))}catch{u("Error","Password reset failed. Wait for a minute and retry."),a()}},{register:E,handleSubmit:b,getValues:M,setValue:Y,watch:$,setError:q,formState:{errors:v,isSubmitting:z}}=T({defaultValues:n.userProfile,resolver:C(J)});return e.jsx("form",{onSubmit:b(y),children:e.jsx("div",{className:`${F} mt-0  
                        rounded-lg pt-4 max-w-[500px] w-full mx-auto`,children:e.jsxs("div",{className:V,children:[e.jsx("div",{className:" text-xl text-gray-700 font-semibold border-b pb-1",children:"Reset Password"}),e.jsxs("div",{className:" pt-3 pb-4 text-[13px] leading-5",children:[e.jsx("b",{children:(w=n.userProfile)==null?void 0:w.email})," is your current email. It will be used be used for password resets or changes."]}),e.jsx("div",{className:"mt-[20px]"}),e.jsx(O,{controlTitle:"Your Email Address",controlPlaceholder:"Retype new password",controlName:"email",controlType:"text",disabled:!0,register:E,changeHandler:j,error:v.email}),e.jsx(I,{working:o,value:"Send Reset Email"})]})})})},pe=()=>{s.useEffect(()=>{A(localStorage)},[]);const n=S();if(!n)return null;const{user:t}=n,[l,d]=s.useState(null),[o,m]=s.useState(null),[r,f]=s.useState(!0);return s.useEffect(()=>{async function u(a){const p=await L(a||"");d(p)}try{t!=null&&t.guid&&u(t==null?void 0:t.guid)}catch(a){console.log(a.message)}},[t==null?void 0:t.guid]),s.useEffect(()=>{l&&m({userProfile:l})},[l]),s.useEffect(()=>{o&&f(!1)},[o]),r?e.jsx(H,{loading:r}):e.jsx(R,{children:e.jsxs(U,{title:"Reset Password",children:[l===null?"Loading...":"",o&&e.jsx(K,{loaderData:o,user:t})]})})};export{pe as default};
