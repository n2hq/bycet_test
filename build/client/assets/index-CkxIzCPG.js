import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,u as xe,b as we}from"./components-CqyJs_9b.js";import{u as ye}from"./AuthContext-BH94oN1s.js";import{f as V,S as Se,aJ as Pe,a6 as _e,a7 as pe,a8 as ge,u as je,a9 as Ne,L as Ie,ad as Ce,aa as Ee,ab as ve,a3 as Te,aY as Be,aZ as Ue,ac as Ae}from"./lib-d-OCgvip.js";import{P as Oe}from"./ProfileLayout-Dkl0s_uP.js";import{u as De,a as Le}from"./zod-DwrW5z8F.js";import{o as Me,s as x,a as u,u as ke,l as Re,Z as ze}from"./types-DBTFAyTi.js";import{p as Fe,P as We,S as Je,I as $e}from"./SelectCurrency-CKqdQlIJ.js";import{u as te}from"./NotificationContext-CJEyd20o.js";import{u as oe,O as Ye}from"./OperationContext-BdFCpeXF.js";import{B as Ge}from"./Button-7Woa2p3a.js";import{I as v}from"./Input-D3HOu0t0.js";import{f as Ze,c as ee}from"./css-CVxtJxAn.js";import{T as se}from"./TextareaWithWordLimit-DQRzKMej.js";import{S as Z}from"./Select-BC9R8HZG.js";import{B as Ve}from"./BusinessMenu-CYgnqm1J.js";import{B as qe}from"./BusinessDrawer-_Mi3vA0Y.js";import{L as He}from"./LoadingMessage-B9wZrrAy.js";import"./LeftNav-Cj9_gra7.js";import"./HomeNav-C5gVOegL.js";import"./MainNav-oY7cNyR2.js";import"./index-CTCnFI3k.js";const Ke=Me({username:u(),pagetype:x({message:"Please select page type"}).min(1,{message:"Please select page type"}),email_address:x({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),title:x().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:x({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:x({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:x().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),long_description:x().nullish().refine(e=>!e||e.trim()===""?!0:e.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:u(),state_code:u(),state_text:u(),country_text:u(),city_id:u(),established:x().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Year established must contain only numbers"}).refine(e=>e===""||e.length<=4,{message:"Year established must not be more than 4 digits"}),zipcode:x().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Zipcode must contain only numbers"}).refine(e=>e===""||e.length<=7,{message:"Zipcode must not be more than 7 digits"}),call_code:u(),phone:x().max(30,{message:"Phone must not be more than 30 characters"}).optional().nullable().refine(e=>!e||e.trim().length>0,{message:"Phone must not be empty"}),minimum_amount_currency_code:u(),minimum_amount:u(),currency:u(),starting_note:u(),intro:u(),category:x().min(2,{message:"Please select a business category"}),business_phrases:ke([Re(""),x({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:u(),services:u(),xsocial:u(),fbsocial:u(),linksocial:u(),website:x().nullable().optional().refine(e=>{if(!e||e==="")return!0;try{return new URL(e),!0}catch{return!1}},{message:"Please enter a valid website. Example: http://example.com"})}).superRefine((e,m)=>{var l,g;((l=e==null?void 0:e.address_two)==null?void 0:l.length)!==0&&((g=e==null?void 0:e.address_two)==null?void 0:g.length)<3&&m.addIssue({code:ze.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),Qe=({listing:e,user:m,businessProfileBgData:l})=>{let g="";l!=null&&l.image_url&&(g=V.IMG_BASE_URL+l.image_url);const[y,T]=t.useState(g),[S,M]=t.useState(null),P=t.useRef(null),[B,j]=t.useState(!1),[w,h]=t.useState(!1);te();const{showOperation:U,showSuccess:C,showError:_,showWarning:E,showInfo:W,completeOperation:p}=oe(),A=()=>{var o;(o=P.current)==null||o.click()},N=o=>{var d;const a=(d=o.target.files)==null?void 0:d[0];if(a){const f=URL.createObjectURL(a);T(f),M(a),j(!0)}},O=async()=>{h(!0),U("processing"),await new Promise(a=>setTimeout(a,1e3));const o=new FormData;if(B){o.append("file",S),o.append("guid",m.user_guid),o.append("bid",e.gid);const d=V.IMG_BASE_URL+"/business_profile_bg_upload";try{const f=await fetch(d,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:o});if(f.ok)C("Success","Image uploaded."),p();else{let k=f.json().then(D=>{_("Error",D.message),p()})}}catch(f){console.log(f.message),_("Error","Image upload failed."),p()}finally{h(!1)}}else _("Error","Please select an image to continue."),p(),h(!1)};return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"relative bg-gray-700 w-full h-[200px] z-[0] shadow-lg text-white flex place-items-center place-content-center flex-col",children:[y===""&&"Add Photo (1920x200)",y&&s.jsx("img",{src:y,alt:"",className:"object-cover w-full h-full  absolute z-[40]"}),s.jsx("input",{type:"file",accept:"image/*",ref:P,className:" hidden",onChange:N})]}),s.jsxs("div",{className:` flex place-items-center gap-1.5
                place-content-center top-[5px] right-[5px] w-fit z-[120] absolute`,children:[s.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:w,onMouseDown:A,children:"Browse"}),s.jsx("button",{className:` bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:O,disabled:w,children:w?"Uploading...":"Upload"})]})]})},Xe=({listing:e,user:m,businessProfileImageData:l})=>{let g="";l!=null&&l.image_url&&(g=V.IMG_BASE_URL+(l==null?void 0:l.image_url));const[y,T]=t.useState(g),[S,M]=t.useState(null),P=t.useRef(null),[B,j]=t.useState(!1),[w,h]=t.useState(!1);te();const{showOperation:U,showSuccess:C,showError:_,showWarning:E,showInfo:W,completeOperation:p}=oe(),A=()=>{var o;(o=P.current)==null||o.click()},N=o=>{var d;const a=(d=o.target.files)==null?void 0:d[0];if(a){const f=URL.createObjectURL(a);T(f),M(a),j(!0)}},O=async()=>{h(!0),U("processing"),await new Promise(a=>setTimeout(a,1e3));const o=new FormData;if(B){o.append("file",S),o.append("guid",m.user_guid),o.append("bid",e.gid);const d=V.IMG_BASE_URL+"/business_profile_pic_upload";try{const f=await fetch(d,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:o});if(f.ok)C("Success","Image uploaded."),p();else{let k=f.json().then(D=>{_("Error",D.message),p()})}}catch{_("Error","Image upload failed"),p()}finally{h(!1)}}else _("Error","Please select an image to continue."),p(),h(!1)};return s.jsxs("div",{children:[s.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden border-[2px] border-gray-200",children:[s.jsx("img",{src:y,alt:"",className:`object-cover w-full h-full z-0 absolute ${y===""?"bg-black":"bg-white"}`}),s.jsx("input",{type:"file",accept:"image/*",ref:P,className:" hidden",onChange:N}),s.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:A,children:s.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    bg-blue-300/50
                                    rounded-full transition duration-300 ease-in-out`,children:s.jsx(Se,{className:" text-[30px]"})})})]}),s.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:s.jsx("button",{className:`${w?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:O,disabled:w,children:w?"Uploading...":"Upload"})})]})},es=({data:e})=>{var ne,ie,le,ae,ce,ue,me,de,fe;const[m,l]=t.useState(e.businessProfile),[g,y]=t.useState(null),[T,S]=t.useState(!1);te();const[M,P]=t.useState(null),[B,j]=t.useState(!1);t.useEffect(()=>{if(e.businessProfile){const c=Pe(m.minimum_amount.toString());b("minimum_amount",c)}},[e]);const{showOperation:w,showSuccess:h,showError:U,showWarning:C,showInfo:_,completeOperation:E}=oe(),W=e==null?void 0:e.currencies,p=e==null?void 0:e.countries;let[A,N]=t.useState(e.states),[O,o]=t.useState(e.cities);const a=(ne=_e)==null?void 0:ne.sort((c,I)=>c.name.localeCompare(I.name)),[d,f]=t.useState((ie=e==null?void 0:e.businessProfile)==null?void 0:ie.country_code),[k,D]=t.useState((le=e==null?void 0:e.businessProfile)==null?void 0:le.state_code),[J,q]=t.useState(""),[L,$]=t.useState(""),H=async c=>{f(c),q(c);const I=await pe(c);N(I),R("")},R=async c=>{D(c),$(c);const I=await ge(d,c);o(I)},r=c=>{let I=c.target.value,X=c.target.name;y(K=>({...K,[X]:I}))},Y=async c=>{var K;S(!0),console.log(c),w("processing","Updating page profile"),await new Promise(F=>setTimeout(F,1e3));const I="/api/listing/"+((K=e==null?void 0:e.businessProfile)==null?void 0:K.gid),X=V.BASE_URL+I;try{const F=await fetch(X,{method:"PUT",headers:je,body:JSON.stringify(c)});if(F.ok)h("Success","Page profile updated."),E();else{const he=await F.text(),be=JSON.parse(he);throw new Error(`${be.error}`)}}catch(F){U("error",`${F.message}`),E()}finally{S(!1)}},{register:n,handleSubmit:Q,getValues:z,setValue:b,watch:G,setError:re,formState:{errors:i,isSubmitting:ss}}=De({defaultValues:m,resolver:Le(Ke)});return t.useEffect(()=>{e.businessProfile&&(b("state_code",e.businessProfile.state_code),b("city_id",e.businessProfile.city_id))},[e.businessProfile]),t.useEffect(()=>{J&&(b("state_code",""),b("city_id",""))},[J,e]),t.useEffect(()=>{L&&b("city_id","")},[L]),s.jsxs("div",{children:[s.jsx(qe,{isOpen:B,businessGuid:(ae=e.businessProfile)==null?void 0:ae.gid,userGuid:(ce=e.businessProfile)==null?void 0:ce.owner}),s.jsx(Qe,{listing:e.businessProfile,user:e.userProfile,businessProfileBgData:e.businessProfileBgData}),s.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:s.jsx("div",{className:"absolute top-[-50px]",children:s.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:s.jsx(Xe,{listing:e.businessProfile,user:e.userProfile,businessProfileImageData:e.businessProfileImageData})})})}),s.jsxs("div",{children:[s.jsx("hr",{className:"mb-4"}),s.jsxs("div",{className:"relative w-full flex place-items-center gap-1 place-content-end px-[10px]",children:[s.jsx("a",{href:"/web/account/portfolio",className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Portfolio"}),s.jsx("a",{href:`/${(ue=e.businessProfile)==null?void 0:ue.gid}`,className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Preview"}),(e==null?void 0:e.businessProfile)&&s.jsx(Ve,{setIsOpen:j,guid:(me=e==null?void 0:e.businessProfile)==null?void 0:me.gid,userGuid:(de=e==null?void 0:e.businessProfile)==null?void 0:de.owner})]}),s.jsx("form",{className:"w-full px-[10px]",onSubmit:Q(Y),children:s.jsxs("div",{className:`${Ze} mt-0  rounded-lg pt-4 md:max-w-[80%]
                                lg:max-w-[60%] w-full mx-auto `,children:[s.jsx("div",{className:"text-2xl leading-[1.4em] px-[10px] text-gray-500 mb-[32px] font-bold text-center bg-gray-100 w-full p-3 border rounded",children:(fe=e==null?void 0:e.businessProfile)==null?void 0:fe.title}),s.jsx(v,{controlTitle:"Page Username",controlPlaceholder:"Enter username",controlName:"username",register:n,changeHandler:r,error:i.username,controlInformation:"Choose a username. "}),s.jsx(Z,{controlTitle:"Page Type",controlName:"pagetype",controlPlaceholder:"Select Page Type",selectJson:Fe,register:n,changeHandler:r,error:i.pagetype,controlInformation:"Select business category."}),s.jsx(v,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:n,changeHandler:r,error:i.email_address,controlInformation:"Email address is compulsory."}),s.jsx(v,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:r,error:i.title,controlInformation:"Please enter page name. Page name is compulsory. "}),s.jsx(Z,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:a,register:n,changeHandler:r,error:i.category,controlInformation:"Select business category."}),s.jsx(v,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:r,error:i.established,controlInformation:"This is the name the business was registered or started "}),s.jsx(v,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:r,error:i.address_one,width:100,controlInformation:"Contact address for the business. "}),s.jsx(v,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:r,error:i.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),s.jsx(Z,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:p,register:n,changeHandler:r,error:i.country_code,setCode:H,controlInformation:"Country the business was registered. "}),s.jsx(Z,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:A,register:n,changeHandler:r,error:i.state_code,setCode:R,controlInformation:"State the business was registered. "}),s.jsx(Z,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:O,register:n,changeHandler:r,error:i.city_id,controlInformation:"City the business was registered. "}),s.jsx(v,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:r,error:i.zipcode,controlInformation:"Enter the zipcode. E.g.: 51234 or 845219 "}),s.jsx(We,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,setValue:b,getValues:z,changeHandler:r,error:i.phone,controlInformation:"Mobile number or phone number. "}),s.jsxs("div",{className:"w-full mt-4 mb-12",children:[s.jsx("div",{className:"text-2xl font-semibold",children:"Minimum rate charged by this business."}),s.jsx("div",{className:"text-[14px] py-4 mb-0 leading-[1.3em]",children:"Select the minimum amount customers or clients are charged to purchase goods/services from this business. This is optional."}),s.jsxs("div",{className:"p-4 border rounded-xl",children:[s.jsx(Je,{controlTitle:"Currency",controlName:"minimum_amount_currency_code",controlPlaceholder:"Select currency",selectJson:W,register:n,changeHandler:r,error:i.minimum_amount_currency_code,setCode:H,setValue:b,controlInformation:"Default currency to receive funds."}),s.jsx("div",{className:"h-2"}),s.jsx($e,{controlTitle:"Minimum amount charged",controlPlaceholder:"Starting amount. E.g. 10 or 30...",controlName:"minimum_amount",register:n,changeHandler:r,error:i.minimum_amount,controlInformation:"Enter the starting amount charged by this business"}),s.jsx("div",{className:"h-2"}),s.jsx(se,{controlTitle:"Short Note",controlPlaceholder:"Short note on offerings.",controlName:"starting_note",register:n,changeHandler:r,error:i.starting_note,setValue:b,getValues:z,watch:G,controlInformationClass:ee,controlInformation:"Short note on services offered and minimum amount offered. Promos also comes here."})]})]}),s.jsx(se,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:r,error:i.short_description,setValue:b,getValues:z,watch:G,controlInformationClass:ee,controlInformation:"Short description of business activities"}),s.jsx(se,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:n,changeHandler:r,error:i.long_description,setValue:b,getValues:z,watch:G,controlInformationClass:ee,controlInformation:"More description about the business."}),s.jsx(v,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:n,changeHandler:r,error:i.website,controlInformation:"Your website should look like this: http://example.com "}),s.jsx(Ge,{working:T})]})})]})]})},js=()=>{var J;t.useEffect(()=>{Ne(localStorage)},[]);const e=xe(),m=ye();if(!m)return null;const l=e.business_guid,g=(J=m==null?void 0:m.user)==null?void 0:J.guid,[y,T]=t.useState(!0),[S,M]=t.useState(null),[P,B]=t.useState(null),[j,w]=t.useState(null),[h,U]=t.useState(null),[C,_]=t.useState(null),[E,W]=t.useState(null),[p,A]=t.useState(null),[N,O]=t.useState(null),[o,a]=t.useState(null),[d,f]=t.useState(null),[k,D]=t.useState(void 0);return we(),t.useEffect(()=>{async function q(L,$){const H=await Ie(L||""),R=await Ce($||"");console.log(R);const r=await Ee(),Y=R,n=await pe(Y.country_code||""),Q=await ge(Y.country_code||"",Y.state_code||""),z=await ve(),b=await Te(L||""),G=await Be($||null),re=await Ue($||""),i=await Ae();M(H),B(R),U(r),w(n),_(Q),W(b),A(G),a(z),O(re),D(i)}try{g&&l&&q(g,l)}catch(L){console.log(L.message)}},[g,l]),t.useEffect(()=>{S&&P&&h&&j&&C&&E&&o&&N&&k&&f({userProfile:S,businessProfile:P,countries:h,states:j,cities:C,userProfileImageData:E,businessProfileImageData:p,businessProfileBgData:N,categories:o,currencies:k})},[o,h,j,C,E,p,S,P,N,k]),t.useEffect(()=>{d&&T(!1)},[d]),y?s.jsx(s.Fragment,{children:s.jsx(He,{})}):s.jsx(Oe,{children:s.jsx(Ye,{children:d!==null&&s.jsx(es,{data:d})})})};export{js as default};
