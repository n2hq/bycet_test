import{j as s}from"./jsx-runtime-0DLF9kdB.js";import{r as t,u as le,e as ce}from"./components-DGrJwBOK.js";import{u as ue}from"./AuthContext-BZd2vK8z.js";import{f as G,D as me,a0 as de,a1 as re,a2 as ne,p as pe,a3 as ge,y as fe,a9 as he,a4 as be,a5 as xe,ai as we,aB as Pe,aC as ye}from"./lib-k8WFHaWl.js";import{P as Se}from"./ProfileLayout-Cz9SPvB-.js";import{u as je,a as _e}from"./zod-MdMXX0Ui.js";import{o as Ie,s as b,a as x,u as Ne,l as Ee,Z as Ce}from"./types-DBTFAyTi.js";import{p as ve,T as te}from"./TextareaWithWordLimit-7NxQgM-o.js";import{u as H}from"./NotificationContext-COGTy5tS.js";import{u as K,O as Te}from"./OperationContext-Cntcaxvx.js";import{B as Be}from"./Button-7Woa2p3a.js";import{I as w}from"./Input-w9wKliLe.js";import{f as De,c as oe}from"./css-CVxtJxAn.js";import{S as $}from"./Select-Bqgb33fH.js";import{B as Ae}from"./BusinessMenu-DbEWNtrr.js";import{B as Oe}from"./BusinessDrawer-CedorsPW.js";import{L as Ue}from"./LoadingMessage-uYfV-qmv.js";import"./LeftNav-B93XguDD.js";import"./HomeNav-BIeS0P5q.js";import"./MainNav-rFCMO_E8.js";import"./index-BcoEYQqA.js";const ke=Ie({username:x(),pagetype:b({message:"Please select page type"}).min(1,{message:"Please select page type"}),email_address:b({message:"Please enter an email."}).min(1,{message:"Email must not be empty"}).email({message:"Please enter a valid email"}),title:b().min(1,{message:"Enter a business name"}).min(3,{message:"Busines Name must not be less than 3 characters"}).max(100,{message:"Business name must not be more than 100 characters."}),country_code:b({message:"Please select a country"}).min(1,{message:"Please enter a country code."}),address_one:b({message:"Please enter an address"}).min(3,{message:"Address must not be less than 3 characters"}).max(100,{message:"Address must not be more than 100 characters"}),short_description:b().refine(e=>e.trim().split(/\s+/).filter(Boolean).length>=30,{message:"You must write at least 30 words."}).refine(e=>e.trim().split(/\s+/).filter(Boolean).length<=60,{message:"You can only write up to 60 words."}),long_description:b().nullish().refine(e=>!e||e.trim()===""?!0:e.trim().split(/\s+/).filter(Boolean).length<=500,{message:"You can only write up to 500 words."}),address_two:x(),state_code:x(),state_text:x(),country_text:x(),city_id:x(),established:b().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Year established must contain only numbers"}).refine(e=>e===""||e.length<=4,{message:"Year established must not be more than 4 digits"}),zipcode:b().optional().nullable().transform(e=>e??"").refine(e=>e===""||/^[0-9]+$/.test(e),{message:"Zipcode must contain only numbers"}).refine(e=>e===""||e.length<=7,{message:"Zipcode must not be more than 7 digits"}),call_code:x(),phone:b().max(30,{message:"Phone must not be more than 30 characters"}).optional().nullable().refine(e=>!e||e.trim().length>0,{message:"Phone must not be empty"}),intro:x(),category:b().min(2,{message:"Please select a business category"}),business_phrases:Ne([Ee(""),b({message:"Please enter business phrase"}).min(3,{message:"Business Phrases must not be less than 3 characters"}).max(1e3,{message:"Business Phrases must not be more than 100 characters"}).nullish()]),products:x(),services:x(),xsocial:x(),fbsocial:x(),linksocial:x(),website:b().nullable().optional().refine(e=>{if(!e||e==="")return!0;try{return new URL(e),!0}catch{return!1}},{message:"Please enter a valid website. Example: http://example.com"})}).superRefine((e,P)=>{var c,u;((c=e==null?void 0:e.address_two)==null?void 0:c.length)!==0&&((u=e==null?void 0:e.address_two)==null?void 0:u.length)<3&&P.addIssue({code:Ce.custom,path:["address_two"],message:"Enter a minimum of 3 characters"})}),Me=({listing:e,user:P,businessProfileBgData:c})=>{let u="";c!=null&&c.image_url&&(u=G.IMG_BASE_URL+c.image_url);const[d,k]=t.useState(u),[M,S]=t.useState(null),j=t.useRef(null),[_,A]=t.useState(!1),[p,y]=t.useState(!1);H();const{showOperation:T,showSuccess:B,showError:g,showWarning:z,showInfo:O,completeOperation:f}=K(),I=()=>{var o;(o=j.current)==null||o.click()},U=o=>{var h;const l=(h=o.target.files)==null?void 0:h[0];if(l){const i=URL.createObjectURL(l);k(i),S(l),A(!0)}},N=async()=>{y(!0),T("processing"),await new Promise(l=>setTimeout(l,1e3));const o=new FormData;if(_){o.append("file",M),o.append("guid",P.user_guid),o.append("bid",e.gid);const h=G.IMG_BASE_URL+"/business_profile_bg_upload";try{const i=await fetch(h,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:o});if(i.ok)B("Success","Image uploaded."),f();else{let F=i.json().then(E=>{g("Error",E.message),f()})}}catch(i){console.log(i.message),g("Error","Image upload failed."),f()}finally{y(!1)}}else g("Error","Please select an image to continue."),f(),y(!1)};return s.jsxs("div",{className:"relative",children:[s.jsxs("div",{className:"relative bg-gray-700 w-full h-[200px] z-[0] shadow-lg text-white flex place-items-center place-content-center flex-col",children:[d===""&&"Add Photo (1920x200)",d&&s.jsx("img",{src:d,alt:"",className:"object-cover w-full h-full  absolute z-[40]"}),s.jsx("input",{type:"file",accept:"image/*",ref:j,className:" hidden",onChange:U})]}),s.jsxs("div",{className:` flex place-items-center gap-1.5
                place-content-center top-[5px] right-[5px] w-fit z-[120] absolute`,children:[s.jsx("button",{className:`bg-white  w-full py-[4px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out px-[8px] `,disabled:p,onMouseDown:I,children:"Browse"}),s.jsx("button",{className:` bg-white  w-full py-[3px] rounded-[8px] border-[1px] border-gray-200 px-[8px]
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:N,disabled:p,children:p?"Uploading...":"Upload"})]})]})},Le=({listing:e,user:P,businessProfileImageData:c})=>{let u="";c.image_url&&(u=G.IMG_BASE_URL+c.image_url);const[d,k]=t.useState(u),[M,S]=t.useState(null),j=t.useRef(null),[_,A]=t.useState(!1),[p,y]=t.useState(!1);H();const{showOperation:T,showSuccess:B,showError:g,showWarning:z,showInfo:O,completeOperation:f}=K(),I=()=>{var o;(o=j.current)==null||o.click()},U=o=>{var h;const l=(h=o.target.files)==null?void 0:h[0];if(l){const i=URL.createObjectURL(l);k(i),S(l),A(!0)}},N=async()=>{y(!0),T("processing"),await new Promise(l=>setTimeout(l,1e3));const o=new FormData;if(_){o.append("file",M),o.append("guid",P.user_guid),o.append("bid",e.gid);const h=G.IMG_BASE_URL+"/business_profile_pic_upload";try{const i=await fetch(h,{method:"POST",headers:{"Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"*"},body:o});if(i.ok)B("Success","Image uploaded."),f();else{let F=i.json().then(E=>{g("Error",E.message),f()})}}catch{g("Error","Image upload failed"),f()}finally{y(!1)}}else g("Error","Please select an image to continue."),f(),y(!1)};return s.jsxs("div",{children:[s.jsxs("div",{className:"relative bg-blue-100 w-[150px] h-[150px] z-40 rounded-full overflow-hidden border-[2px] border-gray-200",children:[s.jsx("img",{src:d,alt:"",className:`object-cover w-full h-full z-0 absolute ${d===""?"bg-black":"bg-white"}`}),s.jsx("input",{type:"file",accept:"image/*",ref:j,className:" hidden",onChange:U}),s.jsx("div",{className:`flex place-content-center place-items-center
                                 bg-black/10 w-full h-full absolute z-0 top-0 object-cover
                                 text-white/80 `,onMouseDown:I,children:s.jsx("div",{className:`w-[50%] h-[50%] flex flex-col
                                    place-content-center place-items-center
                                    hover:cursor-pointer hover:bg-white/50
                                    bg-blue-300/50
                                    rounded-full transition duration-300 ease-in-out`,children:s.jsx(me,{className:" text-[30px]"})})})]}),s.jsx("div",{className:` flex flex-col place-items-center 
                place-content-center mt-2 `,children:s.jsx("button",{className:`${p?"bg-gray-200 cursor-default":"bg-blue-100"}  w-full py-[6px] rounded-[8px] border-[1px] border-gray-200
                        shadow-sm hover:shadow-lg transition duration-500 ease-in-out`,onMouseDown:N,disabled:p,children:p?"Uploading...":"Upload"})})]})},Re=({data:e})=>{var ee,se;const[P,c]=t.useState(null),[u,d]=t.useState(!1);H();const[k,M]=t.useState(null),[S,j]=t.useState(!1),{showOperation:_,showSuccess:A,showError:p,showWarning:y,showInfo:T,completeOperation:B}=K(),g=e.countries;let[z,O]=t.useState(e.states),[f,I]=t.useState(e.cities);const U=(ee=de)==null?void 0:ee.sort((m,v)=>m.name.localeCompare(v.name)),[N,o]=t.useState(e.businessProfile.country_code),[l,h]=t.useState(e.businessProfile.state_code),[i,F]=t.useState(""),[E,J]=t.useState(""),L=async m=>{o(m),F(m);const v=await re(m);O(v),R("")},R=async m=>{h(m),J(m);const v=await ne(N,m);I(v)},r=m=>{let v=m.target.value,q=m.target.name;c(D=>({...D,[q]:v}))},Y=async m=>{d(!0),_("processing","Updating page profile"),await new Promise(D=>setTimeout(D,1e3));const v="/api/listing/"+e.businessProfile.gid,q=G.BASE_URL+v;try{const D=await fetch(q,{method:"PUT",headers:pe,body:JSON.stringify(m)});if(D.ok)A("Success","Page profile updated."),B();else{const ae=await D.text(),ie=JSON.parse(ae);throw new Error(`${ie.error}`)}}catch(D){p("error",`${D.message}`),B()}finally{d(!1)}},{register:n,handleSubmit:W,getValues:Z,setValue:C,watch:V,setError:Q,formState:{errors:a,isSubmitting:X}}=je({defaultValues:e.businessProfile,resolver:_e(ke)});return t.useEffect(()=>{e.businessProfile&&(C("state_code",e.businessProfile.state_code),C("city_id",e.businessProfile.city_id))},[e.businessProfile]),t.useEffect(()=>{i&&(C("state_code",""),C("city_id",""))},[i,e]),t.useEffect(()=>{E&&C("city_id","")},[E]),s.jsxs("div",{children:[s.jsx(Oe,{isOpen:S,businessGuid:e.businessProfile.gid,userGuid:(se=e.businessProfile)==null?void 0:se.owner}),s.jsx(Me,{listing:e.businessProfile,user:e.userProfile,businessProfileBgData:e.businessProfileBgData}),s.jsx("div",{className:"px-[15px]  relative w-full flex place-content-center h-[180px]",children:s.jsx("div",{className:"absolute top-[-50px]",children:s.jsx("div",{className:"flex place-items-center place-content-center flex-col",children:s.jsx(Le,{listing:e.businessProfile,user:e.userProfile,businessProfileImageData:e.businessProfileImageData})})})}),s.jsxs("div",{children:[s.jsx("hr",{className:"mb-4"}),s.jsxs("div",{className:"relative w-full flex place-items-center gap-1 place-content-end px-[10px]",children:[s.jsx("a",{href:"/web/account/portfolio",className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Portfolio"}),s.jsx("a",{href:`/${e.businessProfile.gid}`,className:" py-[9px] px-[20px] rounded-full bg-blue-900 shadow-lg shadow-blue-400 text-white",children:"Preview"}),(e==null?void 0:e.businessProfile)&&s.jsx(Ae,{setIsOpen:j,guid:e==null?void 0:e.businessProfile.gid,userGuid:e==null?void 0:e.businessProfile.owner})]}),s.jsx("form",{className:"w-full px-[10px]",onSubmit:W(Y),children:s.jsxs("div",{className:`${De} mt-0  rounded-lg pt-4 md:max-w-[80%]
                                lg:max-w-[60%] w-full mx-auto `,children:[s.jsx("div",{className:"text-2xl mb-5",children:"Page update"}),s.jsx("div",{className:"text-xl font-[600] leading-[1.4em] px-[10px] text-black mb-[32px]",children:e==null?void 0:e.businessProfile.title}),s.jsx(w,{controlTitle:"Page Username",controlPlaceholder:"Enter username",controlName:"username",register:n,changeHandler:r,error:a.username,controlInformation:"Choose a username. "}),s.jsx($,{controlTitle:"Page Type",controlName:"pagetype",controlPlaceholder:"Select Page Type",selectJson:ve,register:n,changeHandler:r,error:a.pagetype,controlInformation:"Select business category."}),s.jsx(w,{controlTitle:"Email Address",controlPlaceholder:"Enter email address",controlName:"email_address",register:n,changeHandler:r,error:a.email_address,controlInformation:"Email address is compulsory."}),s.jsx(w,{controlTitle:"Business name",controlPlaceholder:"Enter business name",controlName:"title",register:n,changeHandler:r,error:a.title,controlInformation:"Please enter page name. Page name is compulsory. "}),s.jsx($,{controlTitle:"Category",controlName:"category",controlPlaceholder:"Select category",selectJson:U,register:n,changeHandler:r,error:a.category,controlInformation:"Select business category."}),s.jsx(w,{controlTitle:"Year established",controlPlaceholder:"Enter year established",controlName:"established",register:n,changeHandler:r,error:a.established,controlInformation:"This is the name the business was registered or started "}),s.jsx(w,{controlTitle:"Address 1",controlPlaceholder:"Enter address",controlName:"address_one",register:n,changeHandler:r,error:a.address_one,width:100,controlInformation:"Contact address for the business. "}),s.jsx(w,{controlTitle:"Address 2",controlPlaceholder:"Enter address",controlName:"address_two",register:n,changeHandler:r,error:a.address_two,width:100,controlInformation:"E.g. Off North Central Boulevard or North Central Road. "}),s.jsx($,{controlTitle:"Country",controlName:"country_code",controlPlaceholder:"Select country",selectJson:g,register:n,changeHandler:r,error:a.country_code,setCode:L,controlInformation:"Country the business was registered. "}),s.jsx($,{controlTitle:"State",controlName:"state_code",controlPlaceholder:"Select state",selectJson:z,register:n,changeHandler:r,error:a.state_code,setCode:R,controlInformation:"State the business was registered. "}),s.jsx($,{controlTitle:"City",controlName:"city_id",controlPlaceholder:"Select city",selectJson:f,register:n,changeHandler:r,error:a.city_id,controlInformation:"City the business was registered. "}),s.jsx(w,{controlTitle:"Zipcode",controlPlaceholder:"Enter zipcode",controlName:"zipcode",register:n,changeHandler:r,error:a.zipcode,controlInformation:"Enter the zipcode. E.g.: 51234 or 845219 "}),s.jsx(w,{controlTitle:"Phone number",controlPlaceholder:"Enter phone number",controlName:"phone",register:n,changeHandler:r,error:a.phone,controlInformation:"Mobile number or phone number. "}),s.jsx(w,{controlTitle:"Business Phrases",controlPlaceholder:"E.g. Advocates, Software Developers, Architect",controlName:"business_phrases",register:n,changeHandler:r,error:a.business_phrases,controlInformation:"Enter business phrases like: Solicitor, Advocate, Plumber, Business Analyst, Mechanical Engineers."}),s.jsx(w,{controlTitle:"Products",controlPlaceholder:"E.g.: Publications, Accessories, Shoes, Subscriptions, Magazines, Cars",controlName:"products",register:n,changeHandler:r,error:a.products,controlInformation:"Enter your products name like: Magazines, Generators, Accessories, Perfumes, Publications etc."}),s.jsx(w,{controlTitle:"Services",controlPlaceholder:"E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc.",controlName:"services",register:n,changeHandler:r,error:a.services,controlInformation:"Enter your services E.g.: Consulting Services, Project Management, Outsourcing or BPO, Training and Development. etc."}),s.jsx(te,{controlTitle:"Short Description",controlPlaceholder:"Short description",controlName:"short_description",register:n,changeHandler:r,error:a.short_description,setValue:C,getValues:Z,watch:V,controlInformationClass:oe,controlInformation:"Short description of business activities"}),s.jsx(te,{controlTitle:"Long Description",controlPlaceholder:"Long description",controlName:"long_description",register:n,changeHandler:r,error:a.long_description,setValue:C,getValues:Z,watch:V,controlInformationClass:oe,controlInformation:"More description about the business."}),s.jsx(w,{controlTitle:"Website",controlPlaceholder:"Enter website",controlName:"website",register:n,changeHandler:r,error:a.website,controlInformation:"Your website should look like this: http://example.com "}),s.jsx(Be,{working:u})]})})]})]})},is=()=>{var E;const e=localStorage==null?void 0:localStorage.getItem("authTokens");ge(e);const P=le(),c=ue();if(!c)return null;const u=P.business_guid,d=(E=c==null?void 0:c.user)==null?void 0:E.guid,[k,M]=t.useState(!0),[S,j]=t.useState(null),[_,A]=t.useState(null),[p,y]=t.useState(null),[T,B]=t.useState(null),[g,z]=t.useState(null),[O,f]=t.useState(null),[I,U]=t.useState(null),[N,o]=t.useState(null),[l,h]=t.useState(null),[i,F]=t.useState(null);return ce(),t.useEffect(()=>{async function J(L,R){const r=await fe(L||""),Y=await he(R||""),n=await be(),W=Y,Z=await re(W.country_code||""),C=await ne(W.country_code||"",W.state_code||""),V=await xe(),Q=await we(L||""),a=await Pe(R||""),X=await ye(R||"");j(r),A(Y),B(n),y(Z),z(C),f(Q),U(a),h(V),o(X)}try{d&&u&&J(d,u)}catch(L){console.log(L.message)}},[d,u]),t.useEffect(()=>{S&&_&&T&&p&&g&&O&&l&&I&&N&&F({userProfile:S,businessProfile:_,countries:T,states:p,cities:g,userProfileImageData:O,businessProfileImageData:I,businessProfileBgData:N,categories:l})},[l,T,p,g,O,I,S,_,N]),t.useEffect(()=>{i&&M(!1)},[i]),k?s.jsx(s.Fragment,{children:s.jsx(Ue,{})}):s.jsx(Se,{children:s.jsx(Te,{children:i!==null&&s.jsx(Re,{data:i})})})};export{is as default};
