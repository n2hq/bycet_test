import{j as e}from"./jsx-runtime-0DLF9kdB.js";import{r as o,e as H,a as Q}from"./components-CqyJs_9b.js";import{A as Y}from"./AccountLayout-QOHrx1by.js";import{C as Z}from"./ContentLayout-SpVwgp8S.js";import{Q as q,B as K,u as I,f as C,a9 as X,ad as M,ak as ee,al as te,r as se,am as re}from"./lib-d-OCgvip.js";import{u as oe}from"./AuthContext-BH94oN1s.js";import{P as ne}from"./Pagination-DIrFETbL.js";import{u as ae,a as ie}from"./zod-DwrW5z8F.js";import{B as le}from"./Button-7Woa2p3a.js";import{I as ce}from"./Input-D3HOu0t0.js";import{u as ue}from"./OperationContext-BdFCpeXF.js";import{S as me}from"./Select-BC9R8HZG.js";import{o as de,s as J}from"./types-DBTFAyTi.js";import"./LeftNav-Cj9_gra7.js";import"./HomeNav-C5gVOegL.js";import"./MainNav-oY7cNyR2.js";import"./index-CTCnFI3k.js";import"./BusinessMenu-CYgnqm1J.js";import"./BusinessDrawer-_Mi3vA0Y.js";import"./css-CVxtJxAn.js";const $=o.createContext(null),L=()=>{const r=o.useContext($);return r||null},fe=({children:r})=>{const[c,l]=o.useState(!1),[w,s]=o.useState(""),[a,p]=o.useState(""),[t,h]=o.useState(null),[i,u]=o.useState(null),[A,x]=o.useState(null),[P,v]=o.useState(!1);o.useEffect(()=>{t!==null&&V(t),t===null&&(G("social_media_code",""),G("social_media_identifier",""))},[t]);const{showOperation:S,showSuccess:b,showError:N,showWarning:T,showInfo:k,completeOperation:d}=ue(),E=async m=>{const j=C.BASE_URL+"/api/listing/social_media";try{const f=await fetch(j,{method:"POST",headers:I,body:JSON.stringify(m)});if(f.ok)b("Success","Social Media added successfully."),await new Promise(n=>setTimeout(n,2e3)),S("processing","Reloading..."),await new Promise(n=>setTimeout(n,3e3)),window.location.reload(),await new Promise(n=>setTimeout(n,3e3)),d();else{const n=await f.text(),g=JSON.parse(n);throw new Error(`${g.error}`)}}catch(f){N("error",`${f.message}`),d()}finally{v(!1)}},B=async m=>{const y="/api/listing/social_media/"+(t==null?void 0:t.social_media_guid),j=C.BASE_URL+y;try{const f=await fetch(j,{method:"PUT",headers:I,body:JSON.stringify(m)});if(f.ok)b("Success","Social Media UPDATED successfully."),await new Promise(n=>setTimeout(n,2e3)),S("processing","Reloading..."),await new Promise(n=>setTimeout(n,3e3)),window.location.reload(),await new Promise(n=>setTimeout(n,3e3)),d();else{const n=await f.text(),g=JSON.parse(n);throw new Error(`${g.error}`)}}catch(f){N("error",`${f.message}`),d()}finally{v(!1)}},O=async m=>{v(!0),t===null?S("processing","Adding service..."):S("processing","Updating service..."),await new Promise(y=>setTimeout(y,1e3)),t===null?(m.user_guid=w,m.business_guid=a,JSON.parse(JSON.stringify(m)),E(m)):B(m)},D=m=>{let y=m.target.value,j=m.target.name;x(f=>({...f,[j]:y}))},{register:_,handleSubmit:U,getValues:we,setValue:G,watch:Se,reset:V,setError:ve,formState:{errors:R,isSubmitting:be}}=ae({defaultValues:t,resolver:ie(he)});let z={setDialog:l,setUserGuid:s,setBusinessGuid:p,setSocialMediaProfile:h,setSysSocialMedia:u};const F=async m=>{if(confirm("Do you wish to delete this social media. Once deleted, you cannot recover it?")===!0){S("processing","Deleting social media..."),await new Promise(n=>setTimeout(n,2e3));const j="/api/listing/social_media/"+(t==null?void 0:t.social_media_guid),f=C.BASE_URL+j;try{const n=await fetch(f,{method:"DELETE",headers:I});if(n.ok)b("Success","Service DELETED successfully."),await new Promise(g=>setTimeout(g,2e3)),S("processing","Reloading..."),await new Promise(g=>setTimeout(g,3e3)),window.location.reload(),await new Promise(g=>setTimeout(g,3e3)),d();else{const g=await n.text(),W=JSON.parse(g);throw new Error(`${W.error}`)}}catch(n){N("error",`${n.message}`),d()}finally{v(!1)}}};return e.jsxs($.Provider,{value:z,children:[e.jsx("div",{children:c&&e.jsxs("div",{className:"fixed top-0 left-0 w-full right-0 bg-black/40 z-[4000] h-full flex place-items-center place-content-center",onClick:()=>l(!1),children:[e.jsx(pe,{setDialog:l}),e.jsx("div",{className:"mx-3 w-full",children:e.jsxs("div",{className:"max-w-[600px] mx-auto w-full bg-white rounded-[40px] px-[24px] pt-16 relative pb-12",onClick:m=>m.stopPropagation(),children:[e.jsx("div",{className:"absolute top-8 right-8 text-3xl border-[2px] rounded-xl border-gray-500/20 w-[40px] h-[40px] shadow-sm flex place-items-center place-content-center text-gray-500 cursor-pointer hover:bg-gray-100 hover:border-gray-200/50",onClick:()=>l(!1),children:e.jsx(q,{})}),e.jsxs("div",{className:"text-3xl font-semibold",children:[t===null?"Add":"Edit"," Social Media"]}),e.jsx("div",{className:"border rounded-2xl overflow-hidden pl-3 pt-3 mt-4",children:e.jsx("div",{className:"mt-0  h-[330px] overflow-x-hidden overflow-y-auto pr-3",children:e.jsxs("form",{className:"w-full ",onSubmit:U(O),children:[e.jsx(me,{controlTitle:"Social Media Name",controlName:"social_media_code",controlPlaceholder:"Select Social Media",selectJson:i,register:_,changeHandler:D,error:R.category,controlInformation:"Select social media to add to the business."}),e.jsx(ce,{controlTitle:"Social Media Identifier",controlPlaceholder:"Enter a valid url",controlName:"social_media_identifier",register:_,changeHandler:D,error:R.social_media_identifier,controlInformation:"Your url should start like this: http://example.com "}),e.jsx(le,{working:P})]})})}),t!==null&&e.jsx("div",{className:"flex flex-col",onClick:()=>F(t==null?void 0:t.social_media_guid),children:e.jsx("div",{className:"py-4 underline text-xl  cursor-pointer",children:"Delete Social Media"})})]})})]})}),r]})},pe=({setDialog:r})=>e.jsx("div",{onClick:()=>r(!1),children:e.jsx("div",{className:"w-[30px] h-[30px] flex place-items-center place-content-center rounded-full absolute top-2 left-2 bg-white text-[25px] font-bold transition-all ease-in-out duration-700 cursor-pointer hover:bg-white/40",children:e.jsx(K,{})})}),he=de({social_media_code:J({message:"Please enter a service name"}).min(1,{message:"Please enter a service name"}),social_media_identifier:J().nullable().optional().refine(r=>{if(!r||r.trim()==="")return!0;const c=r.trim();try{return new URL(c),!1}catch{}return/^(https?:\/\/|www\.)/i.test(c)?!1:/^[a-zA-Z0-9._-]+$/.test(c)},{message:"Please enter only the username/handle (e.g., 'oracle'), not a full URL."})}),Ve=()=>{o.useEffect(()=>{X(localStorage)},[]);const[r,c]=o.useState(""),[l,w]=o.useState(""),[s,a]=o.useState(!0),[p,t]=o.useState(null),{business_guid:h,user_guid:i}=H(),[u,A]=o.useState(null),[x,P]=o.useState(null),[v,S]=o.useState(null),[b,N]=o.useState(null);oe();const[T]=Q();return o.useEffect(()=>{const k=async(d,E,B)=>{c(d),w(E);const O=await M(d||""),D=await ee(),_=await te(d,E,B),U=_.data||[];S(_.pagination),console.log(_),A(O),t(U),N(D)};try{if(h&&i){const d=parseInt(T.get("page")||"1"),E=parseInt(T.get("limit")||"10");k(h,i,d)}}catch(d){console.log(d.message)}},[i,h]),o.useEffect(()=>{r&&l&&p&&u&&(P({businessGuid:r,userGuid:l,socialMediaList:p,businessProfile:u}),a(!1))},[r,l,p,u]),e.jsx(Y,{children:e.jsx(Z,{title:"Social Media Settings",businessGuid:r,data:x,businessProfile:u,children:e.jsxs(fe,{children:[r&&l&&e.jsx(ge,{userGuid:l,businessGuid:r,sysSocialMedia:b,socialMediaList:p}),v&&p&&r&&l&&b&&e.jsx(xe,{pagination:v,socialMediaList:p,businessGuid:r,userGuid:l,sysSocialMedia:b})]})})})},ge=({userGuid:r,businessGuid:c,sysSocialMedia:l,socialMediaList:w})=>{const s=L();async function a(t,h){const i=new Set(t==null?void 0:t.map(u=>u.social_media_code));return h==null?void 0:h.filter(u=>!i.has(u.id))}const p=async()=>{s==null||s.setDialog(!0),s==null||s.setUserGuid(r),s==null||s.setBusinessGuid(c),s==null||s.setSocialMediaProfile(null);const t=await a(w,l);s==null||s.setSysSocialMedia(t)};return e.jsx("div",{className:"mb-2",children:e.jsx("button",{onMouseDown:p,className:` bg-blue-800 rounded-md px-3 py-1
                text-white hover:bg-blue-700 transition
                duration-500 ease-in-out hover:shadow-md
                 shadow-gray-900 hover:shadow-black/50`,children:"Add Social Media"})})},xe=({pagination:r,socialMediaList:c,businessGuid:l,userGuid:w,sysSocialMedia:s})=>{const a=L(),[p,t]=o.useState(!1),h=async i=>{a==null||a.setDialog(!0),a==null||a.setBusinessGuid(l),a==null||a.setUserGuid(w);const u=await re(i);a==null||a.setSocialMediaProfile(u),a==null||a.setSysSocialMedia(s),t(!0)};return o.useEffect(()=>{c&&console.log(c),s&&console.log(s)},[c,s]),e.jsxs("div",{children:[e.jsxs("div",{className:"mt-6 flex flex-col border rounded-xl overflow-hidden relative",children:[e.jsxs("div",{className:"flex flex-row gap-0 p-3 text-lg font-bold gap-x-2",children:[e.jsx("div",{className:"min-w-[200px] w-[200px]",children:"Social Media Name"}),e.jsx("div",{className:"grow ",children:"Social Media Identifier"})]}),c==null?void 0:c.map((i,u)=>{const A=u%2===0,x=s==null?void 0:s.find(P=>P.id===(i==null?void 0:i.social_media_code));return e.jsxs("div",{onClick:()=>h(i==null?void 0:i.social_media_guid),className:` flex flex-row place-items-center relative ${A&&"bg-gray-100"} border-t py-2 px-3 cursor-pointer gap-x-2`,children:[e.jsx("div",{className:"min-w-[200px] w-[200px] text-base first:border-none line-clamp-1",children:x==null?void 0:x.name}),e.jsxs("div",{className:"md:grow w-full line-clamp-1 text-base",children:[x==null?void 0:x.base_url,se(i==null?void 0:i.social_media_identifier)]})]},u)})]}),e.jsx("div",{className:"mt-6",children:r&&e.jsx(ne,{pagination:r})})]})};export{Ve as default};
